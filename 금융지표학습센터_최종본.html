<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê¸ˆìœµ ì§€í‘œ í•™ìŠµì„¼í„°</title>

  <!-- Tailwind CSS: defer ì œê±° & ìµœìƒë‹¨ ë°°ì¹˜ (FOUC ë°©ì§€) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- API í‚¤ (í•™ìŠµìš© í•˜ë“œì½”ë”©; ìš´ì˜ì€ í”„ë¡ì‹œ ê¶Œì¥) -->
  <meta name="x-api-key" content="AIzaSyBmaHdOmJts1MRUYb5yCopqTUAeUpWC7d8" />
  <script>window.GEMINI_API_KEY = "AIzaSyBmaHdOmJts1MRUYb5yCopqTUAeUpWC7d8";</script>

  <style>
    :root{
      --grad-start:#667eea;--grad-end:#764ba2;
      --card-bg:rgba(255,255,255,.9);--glass-bg:rgba(255,255,255,.95);
      --ring:rgba(102,126,234,.12);--shadow:0 8px 32px rgba(0,0,0,.08);--shadow-hover:0 16px 36px rgba(0,0,0,.12)
    }
    *{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif}
    body{min-height:100vh;background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%)}

    .hero-section{position:relative;overflow:hidden;background:linear-gradient(135deg,var(--grad-start),var(--grad-end))}
    .hero-section::before{content:"";position:absolute;inset:0;opacity:.3;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat}

    .card-modern{background:var(--card-bg);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.2);box-shadow:var(--shadow);transition:transform .25s,box-shadow .25s}
    .card-modern:hover{transform:translateY(-3px);box-shadow:var(--shadow-hover)}
    .glass-card{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.3)}

    .btn-primary{background:linear-gradient(135deg,var(--grad-start),var(--grad-end));color:#fff;font-weight:700;letter-spacing:.02em;transition:transform .15s,box-shadow .2s}
    .btn-primary:hover{transform:translateY(-1px);box-shadow:0 10px 25px rgba(102,126,234,.35)}
    .btn-primary:active{transform:translateY(0)}
    .btn-primary:disabled{opacity:.6;cursor:not-allowed;box-shadow:none}

    .input-modern{background:rgba(255,255,255,.9);border:2px solid rgba(226,232,240,.8);transition:box-shadow .2s,border-color .2s,background .2s;backdrop-filter:blur(10px)}
    .input-modern:focus{background:#fff;border-color:var(--grad-start);box-shadow:0 0 0 4px var(--ring);outline:none}
    .input-modern:focus-visible{outline:2px solid var(--grad-start);outline-offset:2px}

    .keyword-tag{background:rgba(255,255,255,.9);border:1px solid rgba(226,232,240,.8);color:#475569;font-weight:600;transition:transform .12s,box-shadow .12s,background .2s,color .2s}
    .keyword-tag:hover{background:var(--grad-start);color:#fff;transform:translateY(-1px);box-shadow:0 6px 14px rgba(102,126,234,.28)}

    .search-dropdown{background:rgba(255,255,255,.98);backdrop-filter:blur(20px);border:1px solid rgba(226,232,240,.8);box-shadow:0 10px 40px rgba(0,0,0,.08);max-height:400px;overflow-y:auto}
    .search-dropdown-item{transition:background .15s,transform .15s;border-bottom:1px solid rgba(226,232,240,.3)}
    .search-dropdown-item:hover,.search-dropdown-item[aria-selected="true"]{background:rgba(102,126,234,.1);transform:translateX(2px)}

    .search-container{position:relative}
    .search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:#9ca3af;pointer-events:none}
    .clear-icon{position:absolute;right:16px;top:50%;transform:translateY(-50%);color:#9ca3af;cursor:pointer;opacity:0;transition:opacity .15s}
    .clear-icon.visible{opacity:1}
    .search-input{padding-left:48px!important;padding-right:48px!important}

    .related-terms{background:linear-gradient(135deg,rgba(255,247,237,.9),rgba(254,243,199,.9));border:1px solid rgba(251,191,36,.22);backdrop-filter:blur(15px)}
    .related-term{background:rgba(255,255,255,.85);border:1px solid rgba(251,191,36,.35);transition:transform .12s,box-shadow .12s,background .2s,border-color .2s}
    .related-term:hover{background:rgba(251,191,36,.1);border-color:#f59e0b;transform:translateY(-1px);box-shadow:0 4px 12px rgba(251,191,36,.28)}

    .result-highlight{animation:highlightPulse 1.8s ease-in-out}
    @keyframes highlightPulse{0%{box-shadow:0 8px 32px rgba(0,0,0,.08)}50%{box-shadow:0 20px 60px rgba(102,126,234,.28);transform:translateY(-6px)}100%{box-shadow:0 8px 32px rgba(0,0,0,.08)}}
    .scroll-reveal{opacity:0;transform:translateY(22px);transition:all .6s cubic-bezier(.4,0,.2,1)}
    .scroll-reveal.revealed{opacity:1;transform:translateY(0)}

    .tip-card{background:linear-gradient(135deg,rgba(255,245,235,.9),rgba(254,235,200,.9));border:1px solid rgba(251,146,60,.22);backdrop-filter:blur(20px)}
    .investment-tip-card{background:linear-gradient(135deg,rgba(236,253,245,.9),rgba(209,250,229,.9));border:1px solid rgba(34,197,94,.22);backdrop-filter:blur(20px)}

    .loading-spinner{border:3px solid rgba(255,255,255,.35);border-top:3px solid #fff;border-radius:50%;width:20px;height:20px;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .icon-20{width:20px;height:20px}

    @media (prefers-reduced-motion:reduce){
      *{animation-duration:.001ms!important;animation-iteration-count:1!important;transition-duration:.001ms!important;scroll-behavior:auto!important}
    }
  </style>
</head>
<body>
  <!-- Hero -->
  <header class="hero-section">
    <div class="max-w-6xl mx-auto px-6 py-16 relative z-10 text-center">
      <h1 class="text-5xl md:text-6xl font-bold text-white mb-6">ğŸ“Š ê¸ˆìœµ ì§€í‘œ í•™ìŠµì„¼í„°</h1>
      <p class="text-xl text-blue-100 mb-8">ë³µì¡í•œ ê¸ˆìœµ ìš©ì–´ë¥¼ ì‰½ê³  ì§ê´€ì ìœ¼ë¡œ ì´í•´í•˜ì„¸ìš”.<br>AIê°€ ë„ì™€ì£¼ëŠ” ë§ì¶¤í˜• í•™ìŠµ ê²½í—˜ì„ ë§Œë‚˜ë³´ì„¸ìš”.</p>

      <!-- ê²€ìƒ‰ -->
      <div class="max-w-2xl mx-auto">
        <div class="glass-card p-8 rounded-2xl">
          <div class="mb-6 search-container">
            <div class="search-icon" aria-hidden="true">
              <svg class="icon-20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M21.71 20.29l-3.4-3.39A9 9 0 1 0 16.9 18.9l3.39 3.4a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM11 18a7 7 0 1 1 7-7 7 7 0 0 1-7 7z"/></svg>
            </div>

            <input id="searchText" type="text" autocomplete="off"
              class="input-modern search-input w-full p-4 rounded-xl text-lg placeholder-gray-400"
              placeholder="ê¶ê¸ˆí•œ ê¸ˆìœµ ìš©ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ROE, PER, ë“€ë ˆì´ì…˜)"
              role="combobox" aria-expanded="false" aria-autocomplete="list" aria-controls="searchDropdown" />

            <button id="clearIcon" type="button" class="clear-icon" aria-label="ì…ë ¥ ì§€ìš°ê¸°">
              <svg class="icon-20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M18.3 5.71a1 1 0 0 0-1.42 0L12 10.59 7.11 5.7A1 1 0 0 0 5.7 7.11L10.59 12 5.7 16.89a1 1 0 1 0 1.42 1.42L12 13.41l4.89 4.9a1 1 0 0 0 1.42-1.42L13.41 12l4.9-4.89a1 1 0 0 0 0-1.4z"/></svg>
            </button>

            <div id="searchDropdown" class="search-dropdown absolute top-full left-0 right-0 mt-2 rounded-xl hidden z-50" role="listbox" aria-label="ìë™ì™„ì„± ëª©ë¡">
              <div id="dropdownContent"></div>
            </div>
          </div>

          <button id="searchButton" type="button" class="btn-primary w-full py-4 px-8 rounded-xl text-lg">
            <span id="buttonContent" class="inline-flex items-center justify-center gap-2">ğŸ’¡ ì§€ê¸ˆ ë°”ë¡œ ë¶„ì„í•˜ê¸°</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 py-12">
    <!-- ë¹ ë¥¸ ê²€ìƒ‰ -->
    <section class="mb-12" aria-labelledby="quick-search-heading">
      <div class="text-center mb-8">
        <h2 id="quick-search-heading" class="text-3xl font-bold text-gray-800 mb-2">ë¹ ë¥¸ ê²€ìƒ‰</h2>
        <p class="text-gray-600">ìì£¼ ì°¾ëŠ” ê¸ˆìœµ ì§€í‘œë“¤ì„ í´ë¦­í•´ë³´ì„¸ìš”</p>
      </div>

      <div class="grid md:grid-cols-3 gap-8">
        <div class="card-modern p-6 rounded-2xl">
          <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span aria-hidden="true">ğŸ“ˆ</span>ê²½ì œì§€í‘œ</h3>
          <div class="flex flex-wrap gap-2">
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="GDP" type="button">GDP</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜" type="button">CPI</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜" type="button">PPI</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="ì‹¤ì—…ë¥ " type="button">ì‹¤ì—…ë¥ </button>
          </div>
        </div>
        <div class="card-modern p-6 rounded-2xl">
          <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span aria-hidden="true">ğŸ’°</span>ê¸ˆë¦¬Â·í†µí™”</h3>
          <div class="flex flex-wrap gap-2">
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="ê¸°ì¤€ê¸ˆë¦¬" type="button">ê¸°ì¤€ê¸ˆë¦¬</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="ì½œê¸ˆë¦¬" type="button">ì½œê¸ˆë¦¬</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="í™˜ìœ¨" type="button">í™˜ìœ¨</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="í†µí™”ëŸ‰" type="button">í†µí™”ëŸ‰</button>
          </div>
        </div>
        <div class="card-modern p-6 rounded-2xl">
          <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span aria-hidden="true">ğŸ¢</span>ì‹œì¥ì§€í‘œ</h3>
          <div class="flex flex-wrap gap-2">
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="KOSPI" type="button">KOSPI</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="KOSDAQ" type="button">KOSDAQ</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="VIX" type="button">VIX</button>
            <button class="keyword-tag px-4 py-2 rounded-full text-sm" data-keyword="êµ­ê³ ì±„" type="button">êµ­ê³ ì±„</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ê²°ê³¼ + ì‚¬ì´ë“œë°” -->
    <section class="grid lg:grid-cols-3 gap-8">
      <!-- ê²°ê³¼ -->
      <div class="lg:col-span-2 space-y-8">
        <div id="relatedTermsSection" class="hidden scroll-reveal">
          <div class="related-terms p-6 rounded-2xl">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span aria-hidden="true">ğŸ”—</span>ì—°ê´€ ê²€ìƒ‰ì–´</h3>
            <div id="relatedTermsList" class="flex flex-wrap gap-2"></div>
          </div>
        </div>

        <section id="searchResults" class="hidden scroll-reveal" aria-live="polite" aria-atomic="true">
          <div class="card-modern p-8 rounded-2xl">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 flex items-center gap-3"><span aria-hidden="true">ğŸ“‹</span><span id="resultTitle">ê²€ìƒ‰ ê²°ê³¼</span></h2>
            <div id="resultContent" class="space-y-6"></div>
          </div>
        </section>

        <section id="quizSection" class="hidden scroll-reveal">
          <div class="card-modern p-8 rounded-2xl">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-3"><span aria-hidden="true">ğŸ¯</span>í•™ìŠµ í™•ì¸ í€´ì¦ˆ</h3>
              <div id="quizScore" class="text-sm font-medium text-gray-600"></div>
            </div>
            <button id="quizButton" type="button" class="btn-primary w-full py-3 px-6 rounded-xl font-semibold mb-4">ğŸš€ í€´ì¦ˆ ë„ì „í•˜ê¸°</button>
            <div id="quizContent"></div>
          </div>
        </section>
      </div>

      <!-- ì‚¬ì´ë“œë°” -->
      <aside class="space-y-8">
        <section class="card-modern p-6 rounded-2xl">
          <h3 class="text-lg font-semibold text-gray-800 mb-6 flex items-center gap-2"><span aria-hidden="true">ğŸ“Š</span>í•™ìŠµ í˜„í™©</h3>
          <div class="space-y-4">
            <div>
              <div class="flex justify-between text-sm mb-2"><span class="text-gray-600">ê²€ìƒ‰í•œ ìš©ì–´ ìˆ˜</span><span id="searchCount" class="font-semibold">0ê°œ</span></div>
              <div class="w-full bg-gray-200 rounded-full h-3"><div id="searchProgress" class="h-3 rounded-full" style="width:0%; background:linear-gradient(90deg,var(--grad-start),var(--grad-end))"></div></div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-2"><span class="text-gray-600">í€´ì¦ˆ ì •ë‹µë¥ </span><span id="quizAccuracy" class="font-semibold">0%</span></div>
              <div class="w-full bg-gray-200 rounded-full h-3"><div id="accuracyProgress" class="bg-green-400 h-3 rounded-full transition-all duration-300" style="width:0%"></div></div>
            </div>
          </div>
        </section>

        <section class="tip-card p-6 rounded-2xl">
          <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span aria-hidden="true">ğŸ’¡</span>ì˜¤ëŠ˜ì˜ ê¸ˆìœµ TIP</h3>
          <div id="dailyTip" class="text-sm text-gray-700 leading-relaxed mb-4"></div>
          <button id="changeTipBtn" type="button" class="text-xs bg-orange-100 hover:bg-orange-200 text-orange-700 px-3 py-2 rounded-full font-medium">ğŸ”„ ë‹¤ë¥¸ TIP ë³´ê¸°</button>
        </section>

        <section class="investment-tip-card p-6 rounded-2xl">
          <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span aria-hidden="true">ğŸ’°</span>íˆ¬ì í™œìš© TIP</h3>
          <div id="investmentTip" class="text-sm text-gray-700 leading-relaxed mb-4"></div>
          <button id="changeInvTipBtn" type="button" class="text-xs bg-green-100 hover:bg-green-200 text-green-700 px-3 py-2 rounded-full font-medium">ğŸ’¡ íˆ¬ì ì•„ì´ë””ì–´ ë”ë³´ê¸°</button>
        </section>

        <section class="card-modern p-6 rounded-2xl">
          <div class="flex items-center gap-2 mb-3">
            <span aria-hidden="true">ğŸ•’</span>
            <h3 class="text-lg font-semibold text-gray-800">ìµœê·¼ ê²€ìƒ‰ì–´</h3>
            <button id="clearHistory" type="button" class="text-xs text-gray-400 hover:text-red-500 ml-auto">ëª¨ë‘ ì‚­ì œ</button>
          </div>
          <div id="recentSearches" class="space-y-2">
            <p class="text-gray-500 text-sm">ì•„ì§ ê²€ìƒ‰ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </section>
      </aside>
    </section>
  </main>

  <script>
  (()=>{'use strict';
    const $=s=>document.querySelector(s),$$=s=>document.querySelectorAll(s);
    const setText=(el,t)=>{if(el)el.textContent=t??''};const show=el=>el&&el.classList.remove('hidden');const hide=el=>el&&el.classList.add('hidden');
    const escapeHTML=s=>(s??'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#39;');
    const debounce=(fn,w=180)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),w)}};
    const inViewSmooth=el=>{if(!el)return;const prefersReduced=window.matchMedia&&window.matchMedia('(prefers-reduced-motion: reduce)').matches;const top=el.getBoundingClientRect().top+window.scrollY-100;window.scrollTo({top,behavior:prefersReduced?'auto':'smooth'})};

    const LS_RECENT='recentSearches';const searchedTerms=new Set();const quizStats={correct:0,total:0};
    let recentSearches=[];try{recentSearches=JSON.parse(localStorage.getItem(LS_RECENT)||'[]')}catch{}
    let currentObj=null;let highlightedIndex=-1;

    const financialTerms=['PER','PBR','ROE','ROA','EPS','BPS','DPS','GDP','ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜','CPI','ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜','PPI','ì‹¤ì—…ë¥ ','ê¸°ì¤€ê¸ˆë¦¬','ì½œê¸ˆë¦¬','í™˜ìœ¨','í†µí™”ëŸ‰','M1','M2','KOSPI','KOSDAQ','VIX','êµ­ê³ ì±„','íšŒì‚¬ì±„','ì‹ ìš©ë“±ê¸‰','ìœ ë™ë¹„ìœ¨','ë‹¹ì¢Œë¹„ìœ¨','ë¶€ì±„ë¹„ìœ¨','ìê¸°ìë³¸ë¹„ìœ¨','ì´ìë³´ìƒë°°ìˆ˜','ë§¤ì¶œì•¡ì¦ê°€ìœ¨','ì˜ì—…ì´ìµë¥ ','ìˆœì´ìµë¥ ','ë°°ë‹¹ìˆ˜ìµë¥ ','ë°°ë‹¹ì„±í–¥','ë“€ë ˆì´ì…˜','ì»¨ë²¡ì„œí‹°','ë² íƒ€','ì•ŒíŒŒ','ìƒ¤í”„ë¹„ìœ¨','VAR','ì˜µì…˜','ì„ ë¬¼','ETF','REITs','íŒŒìƒìƒí’ˆ','DCF','NPV','IRR','WACC','CAPM','ëª¬í…Œì¹´ë¥¼ë¡œ','ì–‘ì ì™„í™”','í…Œì´í¼ë§','ê¸ˆë¦¬ì¸ìƒ','ì¸í”Œë ˆì´ì…˜','ë””í”Œë ˆì´ì…˜'];
    const relatedTermsMap={'PER':['PBR','ROE','EPS','PSR'],'PBR':['PER','BPS','ìê¸°ìë³¸ë¹„ìœ¨','ROE'],'ROE':['ROA','PER','PBR','ìê¸°ìë³¸ë¹„ìœ¨'],'ROA':['ROE','ì˜ì—…ì´ìµë¥ ','ìˆœì´ìµë¥ ','ìì‚°íšŒì „ìœ¨'],'GDP':['CPI','PPI','ì‹¤ì—…ë¥ ','ê²½ì œì„±ì¥ë¥ '],'VIX':['KOSPI','ë³€ë™ì„±','ì˜µì…˜','íŒŒìƒìƒí’ˆ'],'KOSPI':['KOSDAQ','VIX','P/E','PBR'],'ê¸°ì¤€ê¸ˆë¦¬':['ì½œê¸ˆë¦¬','êµ­ê³ ì±„','íšŒì‚¬ì±„','í†µí™”ì •ì±…'],'í™˜ìœ¨':['ë‹¬ëŸ¬ì¸ë±ìŠ¤','ë¬´ì—­ìˆ˜ì§€','ê²½ìƒìˆ˜ì§€','ì™¸í™˜ë³´ìœ ì•¡'],'CPI':['PPI','GDP','ì¸í”Œë ˆì´ì…˜','ê¸°ì¤€ê¸ˆë¦¬'],'ë°°ë‹¹ìˆ˜ìµë¥ ':['ë°°ë‹¹ì„±í–¥','ë°°ë‹¹ì»¤ë²„ë¦¬ì§€','PER','PBR'],'ìœ ë™ë¹„ìœ¨':['ë‹¹ì¢Œë¹„ìœ¨','ë¶€ì±„ë¹„ìœ¨','ìê¸°ìë³¸ë¹„ìœ¨','ì¬ë¬´ì•ˆì „ì„±'],'ETF':['í€ë“œ','REITs','ì¸ë±ìŠ¤í€ë“œ','ìƒì¥ì§€ìˆ˜í€ë“œ'],'ë“€ë ˆì´ì…˜':['ì»¨ë²¡ì„œí‹°','ê¸ˆë¦¬ìœ„í—˜','ì±„ê¶Œ','ë§Œê¸°'],'ë² íƒ€':['ì•ŒíŒŒ','ìƒ¤í”„ë¹„ìœ¨','CAPM','ì‹œì¥ìœ„í—˜']};
    const basicFinancialTips=[{title:'ğŸ“ˆ PER vs PBR',content:"PERì€ ì£¼ê°€ìˆ˜ìµë¹„ìœ¨ë¡œ 'ì–¼ë§ˆë‚˜ ë¹„ì‹¼ê°€?'ë¥¼, PBRì€ ì£¼ê°€ìˆœìì‚°ë¹„ìœ¨ë¡œ 'ì–¼ë§ˆë‚˜ ì €í‰ê°€ë˜ì—ˆë‚˜?'ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ë‘˜ ë‹¤ ë‚®ì„ìˆ˜ë¡ ì €í‰ê°€ ì£¼ì‹ì¼ ê°€ëŠ¥ì„±ì´ ë†’ì•„ìš”!"},{title:'ğŸ’¹ ROEì™€ ROA êµ¬ë¶„',content:'ROEëŠ” ìê¸°ìë³¸ì´ìµë¥ ë¡œ ì£¼ì£¼ ê´€ì ì—ì„œ, ROAëŠ” ì´ìì‚°ì´ìµë¥ ë¡œ ê²½ì˜ íš¨ìœ¨ì„±ì„ ë´…ë‹ˆë‹¤. ROE > 15%, ROA > 5%ë©´ ìš°ëŸ‰ê¸°ì—…ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆì–´ìš”.'},{title:'ğŸ“Š ë°°ë‹¹ìˆ˜ìµë¥  vs ë°°ë‹¹ì„±í–¥',content:'ë°°ë‹¹ìˆ˜ìµë¥ ì€ ì£¼ê°€ ëŒ€ë¹„ ë°°ë‹¹ê¸ˆ ë¹„ìœ¨, ë°°ë‹¹ì„±í–¥ì€ ìˆœì´ìµ ëŒ€ë¹„ ë°°ë‹¹ê¸ˆ ë¹„ìœ¨ì…ë‹ˆë‹¤. ë†’ì€ ë°°ë‹¹ìˆ˜ìµë¥ ì´ë¼ë„ ë°°ë‹¹ì„±í–¥ì´ 80% ì´ìƒì´ë©´ ì§€ì†ê°€ëŠ¥ì„±ì„ ì˜ì‹¬í•´ì•¼ í•´ìš”.'},{title:'âš¡ ìœ ë™ë¹„ìœ¨ê³¼ ë‹¹ì¢Œë¹„ìœ¨',content:'ìœ ë™ë¹„ìœ¨ì€ 200% ì´ìƒ, ë‹¹ì¢Œë¹„ìœ¨ì€ 100% ì´ìƒì´ë©´ ë‹¨ê¸° ì•ˆì „ì„±ì´ ì–‘í˜¸í•©ë‹ˆë‹¤. íŠ¹íˆ ë‹¹ì¢Œë¹„ìœ¨ì€ ì¬ê³ ìì‚°ì„ ì œì™¸í•œ ì§„ì§œ ìœ ë™ì„±ì„ ë³´ì—¬ì¤˜ìš”.'},{title:'ğŸ›ï¸ ë¶€ì±„ë¹„ìœ¨ê³¼ ì´ìë³´ìƒë°°ìˆ˜',content:'ë¶€ì±„ë¹„ìœ¨ 200% ì´í•˜, ì´ìë³´ìƒë°°ìˆ˜ 5ë°° ì´ìƒì´ë©´ ì¬ë¬´ ì•ˆì •ì„±ì´ ìš°ìˆ˜í•©ë‹ˆë‹¤. ì´ìë³´ìƒë°°ìˆ˜ëŠ” ì˜ì—…ì´ìµ/ì´ìë¹„ìš©ìœ¼ë¡œ ê³„ì‚°í•´ìš”.'}];
    const investmentTips=[{title:'ğŸ“Š ê¸ˆë¦¬ì™€ ì„¹í„° ë¡œí…Œì´ì…˜',content:'ê¸ˆë¦¬ ìƒìŠ¹ê¸°ì—ëŠ” ì€í–‰ì£¼ê°€ ê°•ì„¸ë¥¼, ê¸ˆë¦¬ í•˜ë½ê¸°ì—ëŠ” ì„±ì¥ì£¼(IT, ë°”ì´ì˜¤)ê°€ ê°•ì„¸ë¥¼ ë³´ì…ë‹ˆë‹¤. 10ë…„ êµ­ì±„ ìˆ˜ìµë¥  ë°©í–¥ì„±ì„ ë³´ê³  í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘ì„ ì¡°ì •í•˜ì„¸ìš”!'},{title:'ğŸ’° VIX ì§€ìˆ˜ í™œìš©ë²•',content:'VIX 30 ì´ìƒì¼ ë•Œ ë§¤ìˆ˜, 15 ì´í•˜ì¼ ë•Œ ë§¤ë„í•˜ëŠ” ì—­ë°œìƒ ì „ëµì´ íš¨ê³¼ì ì…ë‹ˆë‹¤. ê³µí¬ì™€ íƒìš• ì§€ìˆ˜ë¡œ ë¶ˆë¦¬ëŠ” VIXëŠ” ì‹œì¥ ì €ì ê³¼ ê³ ì ì„ ì°¾ëŠ” ë° ìœ ìš©í•´ìš”.'},{title:'ğŸ“ˆ ì´ë™í‰ê· ì„  ê³¨ë“  í¬ë¡œìŠ¤',content:'20ì¼ì„ ì´ 60ì¼ì„ ì„ ìƒí–¥ ëŒíŒŒí•˜ë©´ ë‹¨ê¸° ìƒìŠ¹ ì‹ í˜¸, 60ì¼ì„ ì´ 120ì¼ì„ ì„ ëŒíŒŒí•˜ë©´ ì¤‘ì¥ê¸° ìƒìŠ¹ ì‹ í˜¸ì…ë‹ˆë‹¤. ê±°ë˜ëŸ‰ì´ í•¨ê»˜ ëŠ˜ì–´ë‚˜ë©´ ì‹ ë¢°ë„ê°€ ë†’ì•„ì ¸ìš”.'},{title:'ğŸŒ í™˜ìœ¨ê³¼ ìˆ˜ì¶œì£¼ ì—°ë™ì„±',content:'ì›ë‹¬ëŸ¬ í™˜ìœ¨ ìƒìŠ¹(ì›í™” ì•½ì„¸) ì‹œ ìˆ˜ì¶œ ëŒ€ê¸°ì—…ì´ ìœ ë¦¬í•˜ê³ , í™˜ìœ¨ í•˜ë½ ì‹œ ë‚´ìˆ˜ì£¼ê°€ ìœ ë¦¬í•©ë‹ˆë‹¤. 1,300ì› ê·¼ì²˜ê°€ ì†ìµë¶„ê¸°ì ì¸ ê¸°ì—…ë“¤ì´ ë§ì•„ìš”.'},{title:'ğŸ’ ë°¸ë¥˜ì—ì´ì…˜ í•¨ì • í”¼í•˜ê¸°',content:'PERì´ ë‚®ë‹¤ê³  ë¬´ì¡°ê±´ ì €í‰ê°€ëŠ” ì•„ë‹™ë‹ˆë‹¤. ì—…ì¢… í‰ê·  PER, ì„±ì¥ë¥ , ROEë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë´ì•¼ í•´ìš”. PEG(PER/ì„±ì¥ë¥ ) 1 ì´í•˜ë©´ í•©ë¦¬ì  ê°€ê²©ì´ì—ìš”.'}];

    const searchText=$('#searchText'),searchButton=$('#searchButton'),buttonContent=$('#buttonContent');
    const searchResults=$('#searchResults'),resultTitle=$('#resultTitle'),resultContent=$('#resultContent');
    const quizSection=$('#quizSection'),quizButton=$('#quizButton'),quizContent=$('#quizContent');
    const searchDropdown=$('#searchDropdown'),dropdownContent=$('#dropdownContent'),clearIcon=$('#clearIcon');
    const relatedTermsSection=$('#relatedTermsSection'),relatedTermsList=$('#relatedTermsList');
    const searchCount=$('#searchCount'),searchProgress=$('#searchProgress');
    const quizAccuracy=$('#quizAccuracy'),accuracyProgress=$('#accuracyProgress');
    const recentSearchesBox=$('#recentSearches'),clearHistoryBtn=$('#clearHistory');
    const changeTipBtn=$('#changeTipBtn'),changeInvTipBtn=$('#changeInvTipBtn');
    const dailyTipBox=$('#dailyTip'),investmentTipBox=$('#investmentTip');

    const getApiKey=()=>{const m=document.querySelector('meta[name="x-api-key"]');return(m&&m.content)||window.GEMINI_API_KEY||''};
    const buildPrompt=q=>`ë‹¹ì‹ ì€ ê¸ˆìœµ ì „ë¬¸ ê°•ì‚¬ì…ë‹ˆë‹¤. \n"${q}"ì— ëŒ€í•´ ì•„ë˜ í•­ëª©ë³„ë¡œ ê°„ë‹¨í•˜ê³  ëª…í™•í•˜ê²Œ í•œêµ­ì–´ë¡œ ì„¤ëª…í•´ ì£¼ì„¸ìš”. \në¶ˆí•„ìš”í•œ ë¬¸ì¥ì€ ì“°ì§€ ë§ê³ , ê° í•­ëª©ì€ ì§§ê²Œ ìš”ì•½ëœ í˜•íƒœë¡œë§Œ ì‘ì„±í•´ ì£¼ì„¸ìš”. \në°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ë°˜í™˜í•˜ì„¸ìš”.\n\ní•­ëª©:\n1. title: ìš©ì–´ëª…\n2. definition: ì •ì˜ (2~3ë¬¸ì¥ ìš”ì•½)\n3. method: ê³„ì‚° ë°©ë²• (ê³µì‹ ë˜ëŠ” ê°„ë‹¨í•œ ë°©ì‹)\n4. organization: ë°œí‘œê¸°ê´€ (í•œêµ­ ê¸°ì¤€)\n5. cycle: ë°œí‘œì£¼ê¸° (ì›”ê°„/ë¶„ê¸°/ì—°ê°„ ë“±)\n6. market_use: ì£¼ì‹/ì±„ê¶Œ/ETF ë“±ì—ì„œì˜ í™œìš©\n7. investment: íˆ¬ì ì‹œ í™œìš©ë²•\n8. notes: ìœ ì˜ì‚¬í•­\n\n{\n  "title": "ìš©ì–´ëª…",\n  "definition": "ì •ì˜ ì„¤ëª…",\n  "method": "ê³„ì‚° ë°©ë²•",\n  "organization": "ë°œí‘œê¸°ê´€",\n  "cycle": "ë°œí‘œì£¼ê¸°",\n  "market_use": "ì‹œì¥ í™œìš©",\n  "investment": "íˆ¬ì í™œìš©ë²•",\n  "notes": "ìœ ì˜ì‚¬í•­"\n}`;
    const callGemini=async prompt=>{const key=getApiKey();if(!key)throw new Error('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. <meta name="x-api-key"> í˜•íƒœë¡œ ë„£ì–´ì£¼ì„¸ìš”.');const url=`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${key}`;const res=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{role:'user',parts:[{text:prompt}]}]})});const data=await res.json();if(!res.ok)throw new Error(data?.error?.message||`HTTP ${res.status}`);return data.candidates?.[0]?.content?.parts?.[0]?.text||''};

    const updateProgress=()=>{const cnt=searchedTerms.size;setText(searchCount,`${cnt}ê°œ`);const pct=Math.min((cnt/20)*100,100);searchProgress.style.width=`${pct}%`;if(quizStats.total>0){const acc=Math.round((quizStats.correct/quizStats.total)*100);setText(quizAccuracy,`${acc}%`);accuracyProgress.style.width=`${acc}%`}};
    const renderRecentSearches=()=>{if(!recentSearches.length){recentSearchesBox.innerHTML='<p class="text-gray-500 text-sm">ì•„ì§ ê²€ìƒ‰ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';return}recentSearchesBox.innerHTML=recentSearches.map(t=>`<button type="button" class="block w-full text-left px-3 py-2 text-sm bg-gray-50 hover:bg-gray-100 rounded-lg" data-action="search-term" data-term="${escapeHTML(t)}">${escapeHTML(t)}</button>`).join('')};
    const pushRecent=t=>{if(!t)return;recentSearches=[t,...recentSearches.filter(x=>x!==t)].slice(0,10);localStorage.setItem(LS_RECENT,JSON.stringify(recentSearches));renderRecentSearches()};
    const showRelatedTerms=term=>{const rel=relatedTermsMap[term]||[];if(!rel.length){hide(relatedTermsSection);return}relatedTermsList.innerHTML=rel.map(t=>`<button type="button" class="related-term px-4 py-2 rounded-full text-sm font-medium" data-action="search-term" data-term="${escapeHTML(t)}">${escapeHTML(t)}</button>`).join('');show(relatedTermsSection)};
    const infoCard=(emoji,title,text,cls='')=>`<div class="p-6 ${cls} rounded-xl border-l-4"><h4 class="text-xl font-bold flex items-center gap-2 mb-3">${emoji}<span>${escapeHTML(title)}</span></h4><p class="text-gray-700 leading-relaxed">${escapeHTML(text)}</p></div>`;
    const renderFromJson=obj=>{currentObj=obj;setText(resultTitle,obj.title||'ê²€ìƒ‰ ê²°ê³¼');
      const def=infoCard('ğŸ“˜','ì •ì˜',obj.definition,'bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-500 text-blue-700');
      const method=`<div class="p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border-l-4 border-purple-500"><h4 class="text-xl font-bold text-purple-700 flex items-center gap-2 mb-3">ğŸ§®<span>ê³„ì‚° ë°©ë²•</span></h4><div class="bg-white p-4 rounded-lg shadow-sm text-gray-700">${escapeHTML(obj.method)}</div></div>`;
      const orgCycle=`<div class="grid md:grid-cols-2 gap-4">${infoCard('ğŸ›ï¸','ë°œí‘œê¸°ê´€',obj.organization,'bg-gradient-to-r from-green-50 to-emerald-50 border-green-500 text-green-700')}${infoCard('â°','ë°œí‘œì£¼ê¸°',obj.cycle,'bg-gradient-to-r from-cyan-50 to-blue-50 border-cyan-500 text-cyan-700')}</div>`;
      const market=infoCard('ğŸ“ˆ','ì‹œì¥ í™œìš©',obj.market_use,'bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-500 text-yellow-700');
      const invest=infoCard('ğŸ’¼','íˆ¬ì í™œìš©ë²•',obj.investment,'bg-gradient-to-r from-teal-50 to-cyan-50 border-teal-500 text-teal-700');
      const notes=infoCard('âš ï¸','ìœ ì˜ì‚¬í•­',obj.notes,'bg-gradient-to-r from-red-50 to-pink-50 border-red-500 text-red-700');
      resultContent.innerHTML=`<div class="grid gap-6">${def}${method}${orgCycle}${market}${invest}${notes}</div>`;
      if(!searchedTerms.has(obj.title))searchedTerms.add(obj.title);pushRecent(obj.title);updateProgress();showRelatedTerms(obj.title);
      show(quizSection);quizContent.innerHTML='';quizButton.onclick=()=>generateQuiz(obj);
      show(searchResults);requestAnimationFrame(()=>{const c=searchResults.querySelector('.card-modern');if(c)c.classList.add('result-highlight')});inViewSmooth(searchResults);
      $$('.scroll-reveal').forEach((el,i)=>setTimeout(()=>el.classList.add('revealed'),i*150));
    };

    const updateComboboxA11y=open=>{searchText.setAttribute('aria-expanded',open?'true':'false');if(!open)highlightedIndex=-1};
    const renderAutocomplete=matches=>{dropdownContent.innerHTML=matches.map((t,i)=>`<div class="search-dropdown-item px-4 py-3 cursor-pointer flex items-center gap-3" role="option" aria-selected="${i===highlightedIndex}" data-index="${i}" data-term="${escapeHTML(t)}"><div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-sm font-semibold">${escapeHTML(t.charAt(0))}</div><div class="flex-1"><div class="font-medium text-gray-800">${escapeHTML(t)}</div><div class="text-xs text-gray-500">ê¸ˆìœµ ì§€í‘œ</div></div><div class="text-gray-400" aria-hidden="true"><svg class="icon-20" viewBox="0 0 24 24" fill="currentColor"><path d="M8.5 12.8l-2.9-2.9L4 11.5l4.5 4.5L20 4.5 18.4 3 8.5 12.8z"/></svg></div></div>`).join('');show(searchDropdown);updateComboboxA11y(true)};
    const hideAutocomplete=()=>{hide(searchDropdown);updateComboboxA11y(false)};
    const selectAutocomplete=term=>{searchText.value=term;clearIcon.classList.add('visible');hideAutocomplete();fetchGemini(term)};
    const handleAutocomplete=debounce(q=>{if(!q.trim()){hideAutocomplete();return}const m=financialTerms.filter(t=>t.toLowerCase().includes(q.toLowerCase())).slice(0,8);m.length?renderAutocomplete(m):hideAutocomplete()},120);

    const clearHistory=()=>{recentSearches=[];localStorage.removeItem(LS_RECENT);renderRecentSearches()};

    const fetchGemini=async query=>{if(!query)return;buttonContent.innerHTML='<span class="loading-spinner"></span><span class="ml-2">ë¶„ì„ ì¤‘...</span>';searchButton.disabled=true;
      try{const raw=await callGemini(buildPrompt(query));const cleaned=raw.replace(/```json|```/g,'').trim();const obj=JSON.parse(cleaned);renderFromJson(obj)}
      catch(e){show(searchResults);setText(resultTitle,'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');const escMsg=escapeHTML(e.message);const escQ=escapeHTML(query);
        resultContent.innerHTML=`<div class="p-6 bg-red-50 rounded-xl border border-red-200 text-red-700"><p class="font-semibold mb-2">âš ï¸ ${escMsg}</p><p class="text-sm text-gray-600 mb-3">API í‚¤ í™•ì¸ ë˜ëŠ” ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p><button type="button" class="btn-primary px-4 py-2 rounded-lg" onclick="(${fetchGemini.toString()})('${escQ}')">ë‹¤ì‹œ ì‹œë„</button></div>`;inViewSmooth(searchResults)}
      finally{buttonContent.textContent='ğŸ’¡ ì§€ê¸ˆ ë°”ë¡œ ë¶„ì„í•˜ê¸°';searchButton.disabled=false}
    };

    const generateQuiz=async obj=>{quizContent.innerHTML='<div class="flex items-center justify-center py-8"><div class="loading-spinner"></div><span class="ml-2">í€´ì¦ˆ ìƒì„± ì¤‘...</span></div>';
      const prompt=`"${obj.title}"ì— ëŒ€í•œ 4ì§€ì„ ë‹¤ í€´ì¦ˆë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.\n- ì‹¤ë¬´ì—ì„œ í™œìš© ê°€ëŠ¥í•œ ìˆ˜ì¤€ì˜ ë¬¸ì œ\n- ë³´ê¸°ëŠ” ëª…í™•í•˜ê³  êµ¬ë³„ë˜ê²Œ\n- ë‚œì´ë„ëŠ” ì´ˆê¸‰~ì¤‘ê¸‰ ìˆ˜ì¤€\n\nJSON í˜•ì‹ìœ¼ë¡œë§Œ ë°˜í™˜:\n{\n  "question":"ë¬¸ì œ",\n  "options":["ì„ íƒì§€1","ì„ íƒì§€2","ì„ íƒì§€3","ì„ íƒì§€4"],\n  "answer":"ì •ë‹µ",\n  "explanation":"ì •ë‹µ í•´ì„¤"\n}\n\nê¸°ë°˜ ë°ì´í„°: ${JSON.stringify(obj)}`;
      try{const raw=await callGemini(prompt);const quizObj=JSON.parse(raw.replace(/```json|```/g,'').trim());let answered=false;
        const qWrap=document.createElement('div');qWrap.className='p-6 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl';
        const qText=document.createElement('p');qText.className='text-lg font-semibold mb-6 text-gray-800';qText.textContent=`Q. ${quizObj.question}`;qWrap.appendChild(qText);
        const feedback=document.createElement('div');feedback.className='mt-6 p-6 rounded-xl hidden';feedback.setAttribute('role','status');feedback.setAttribute('aria-live','polite');
        quizObj.options.forEach((opt,idx)=>{const btn=document.createElement('button');btn.type='button';btn.className='block w-full text-left px-4 py-3 mb-3 rounded-lg border-2 border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all font-medium';btn.textContent=`${idx+1}. ${opt}`;
          btn.onclick=()=>{if(answered)return;answered=true;quizStats.total++;const all=qWrap.querySelectorAll('button');
            if(opt===quizObj.answer){btn.classList.add('bg-green-100','border-green-500','text-green-700');feedback.className='mt-6 p-6 rounded-xl bg-green-50 border-2 border-green-200';feedback.innerHTML=`<div class="flex items-center gap-3 mb-3"><span class="text-3xl">ğŸ‰</span><span class="font-bold text-green-700 text-lg">ì •ë‹µì…ë‹ˆë‹¤!</span></div><p class="text-green-700">${escapeHTML(quizObj.explanation)}</p>`;quizStats.correct++}
            else{btn.classList.add('bg-red-100','border-red-500','text-red-700');all.forEach(b=>{if(b.textContent?.includes(quizObj.answer))b.classList.add('bg-green-100','border-green-500','text-green-700')});feedback.className='mt-6 p-6 rounded-xl bg-red-50 border-2 border-red-200';feedback.innerHTML=`<div class="flex items-center gap-3 mb-3"><span class="text-3xl">ğŸ˜…</span><span class="font-bold text-red-700 text-lg">ì•„ì‰½ë„¤ìš”!</span></div><p class="text-red-700 mb-2">ì •ë‹µ: ${escapeHTML(quizObj.answer)}</p><p class="text-gray-700">${escapeHTML(quizObj.explanation)}</p>`}
            qWrap.querySelectorAll('button').forEach(b=>b.disabled=true);updateProgress();feedback.classList.remove('hidden');
            const nextBtn=document.createElement('button');nextBtn.type='button';nextBtn.className='mt-6 btn-primary px-8 py-3 rounded-lg font-semibold';nextBtn.textContent='ğŸ”„ ë‹¤ìŒ ë¬¸ì œ';nextBtn.onclick=()=>generateQuiz(currentObj);feedback.appendChild(nextBtn)};qWrap.appendChild(btn)});
        qWrap.appendChild(feedback);quizContent.innerHTML='';quizContent.appendChild(qWrap)}
      catch(e){quizContent.innerHTML=`<div class="p-6 bg-red-50 rounded-lg border border-red-200 text-red-700">í€´ì¦ˆ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${escapeHTML(e.message)}</div>`}
    };

    searchButton.addEventListener('click',()=>{const q=searchText.value.trim();if(q)fetchGemini(q)});
    searchText.addEventListener('input',e=>{const q=e.target.value;clearIcon.classList.toggle('visible',!!q);handleAutocomplete(q)});
    searchText.addEventListener('keydown',e=>{const items=dropdownContent.querySelectorAll('[role="option"]');
      if(e.key==='ArrowDown'){e.preventDefault();highlightedIndex=Math.min(highlightedIndex+1,items.length-1);items.forEach((it,i)=>it.setAttribute('aria-selected',i===highlightedIndex));if(items[highlightedIndex]){items[highlightedIndex].id=`opt-${highlightedIndex}`;items[highlightedIndex].scrollIntoView({block:'nearest'});searchText.setAttribute('aria-activedescendant',`opt-${highlightedIndex}`)}}
      else if(e.key==='ArrowUp'){e.preventDefault();highlightedIndex=Math.max(highlightedIndex-1,0);items.forEach((it,i)=>it.setAttribute('aria-selected',i===highlightedIndex));if(items[highlightedIndex]){items[highlightedIndex].id=`opt-${highlightedIndex}`;items[highlightedIndex].scrollIntoView({block:'nearest'});searchText.setAttribute('aria-activedescendant',`opt-${highlightedIndex}`)}}
      else if(e.key==='Enter'){e.preventDefault();if(items[highlightedIndex])selectAutocomplete(items[highlightedIndex].dataset.term);else{const q=searchText.value.trim();if(q)fetchGemini(q)}}else if(e.key==='Escape'){hideAutocomplete()}
    });
    dropdownContent.addEventListener('click',e=>{const it=e.target.closest('[role="option"]');if(it)selectAutocomplete(it.dataset.term)});
    clearIcon.addEventListener('click',()=>{searchText.value='';clearIcon.classList.remove('visible');hideAutocomplete();searchText.focus()});
    document.addEventListener('click',e=>{const t=e.target.closest('[data-action="search-term"], .keyword-tag');if(t){const term=t.dataset.term||t.dataset.keyword;if(term){searchText.value=term;clearIcon.classList.add('visible');fetchGemini(term)}}if(!e.target.closest('.search-container'))hideAutocomplete()});
    clearHistoryBtn.addEventListener('click',clearHistory);

    let tipIdx=0,invTipIdx=0;const renderTips=()=>{const t=basicFinancialTips[tipIdx%basicFinancialTips.length];const it=investmentTips[invTipIdx%investmentTips.length];dailyTipBox.innerHTML=`<p class="font-semibold text-orange-600 mb-2">${escapeHTML(t.title)}</p><p>${escapeHTML(t.content)}</p>`;investmentTipBox.innerHTML=`<p class="font-semibold text-green-600 mb-2">${escapeHTML(it.title)}</p><p>${escapeHTML(it.content)}</p>`};
    changeTipBtn.addEventListener('click',()=>{tipIdx++;renderTips()});changeInvTipBtn.addEventListener('click',()=>{invTipIdx++;renderTips()});

    renderTips();renderRecentSearches();updateProgress();
  })();
  </script>
</body>
</html>
